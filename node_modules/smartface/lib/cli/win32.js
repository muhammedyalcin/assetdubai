const utility = require('../utility');
const smfModule = require('../smfbuilder');
const collector = require('../collector/index');
const globalData = require('../globalData');

function run(data) {
	var argv = globalData.get('args');
	if (!argv.java && argv.task === 'Android-publish') {
		return utility.javaFinder(function(err, javaPath) {
			if (javaPath) {
				argv.java = javaPath;
				execute(data);
			}
		});
	}
	execute(data);
}

function execute(data) {
	var argv = globalData.get('args');
	var config = collector.collect(data, argv.platform, argv);
	globalData.set('config', config);
	smfModule.run(config, data);
}

exports.handle_task = run;