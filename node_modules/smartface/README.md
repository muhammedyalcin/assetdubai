# Smartface CLI Tool

This [Node.js](https://nodejs.org/) CLI tool handles various tasks of the Smartface Framework, including the publishing process to create native iOS and Android apps from JavaScript code. You can use any platform to develop native mobile apps.

Other features will be integrated in the future, such as Android and iOS emulator, drag & drop interface integration and possibly more.

[![NPM](https://nodei.co/npm/smartface.png?downloads=true&downloadRank=true&stars=true)](https://nodei.co/npm/smartface/)

# Requirements

## For Debian or Ubuntu

Certain libraries must be installed to publish for Android.

Run the command below from your terminal:

    sudo apt-get install -y lib32z1 lib32ncurses5 lib32bz2-1.0 lib32stdc++6

## For All Platforms

These requirements are for all platforms like Linux, Mac OSX and Windows systems.

### Java SE Development Kit 7u79

You need to install Java 1.7 JDK to publish for Android.

You can find more information from its [download page](http://www.oracle.com/technetwork/java/javase/downloads/java-archive-downloads-javase7-521261.html#jdk-7u79-oth-JPR).

### Android Tools (Optional)

If you want to immediately publish the output to a device or a running emulator instance, you also need to install Android Tools.

You can find more information from its [download page](http://developer.android.com/sdk/index.html).

Scroll down to _SDK Tools Only_ under _Other Download Options_ section.

Installation instruction are [here](http://developer.android.com/sdk/installing/index.html?pkg=tools).

### Node.js

[Node.js](https://nodejs.org/download) version `4.4.5` or greater is required for the current release.

We recommend 

[Nvm](https://github.com/creationix/nvm) can be used to install and manage multiple versions of Node.js on Mac OSX and Linux environments.

You need to make sure you add `. ~/.nvm/nvm.sh` to `~/.bashrc`, `~/.profile`, or `~/.zshrc` file so that it would load when a terminal tab is opened. You can find more details from the link above.

You should also close and re-open the terminal after you installed `nvm`.

[Npm](https://npmjs.com) is used to install dependencies, any recent installation that includes Node.js version `4.4.5` should be sufficient.

You can install `4.4.5` with `nvm` like this:

    nvm install 4.4.5

You can also set this version to be the default version

    nvm alias default 4.4.5
    which node

Something similar to `~/.nvm/versions/node/v4.4.5/bin/node` should be displayed.

### git (Optional)

If you want to download sample projects, you must [install git](https://git-scm.com/book/en/v2/Getting-Started-Installing-Git).

It should also be visible from your shell environment.

You can check this through your command line.

For Mac OSX or Linux

    which git

For Windows

    where git.exe

If you installed Git but do not see it when you use the command above in Windows, you need to make sure that you set its Environment variable correctly.

# Smartface Installation
    npm install smartface -g
    
# "_Sudo_" Issue When Installing Smartface

In Linux and Unix systems, when installing global modules for Node.js, you may run into a problem where you may be asked to install with super user privileges by using the `sudo` command.

You can learn how to fix this issue from [https://docs.npmjs.com/getting-started/fixing-npm-permissions](https://docs.npmjs.com/getting-started/fixing-npm-permissions).

-------------
# Usage

This tool creates publish output for both Android and iOS for Smartface Cloud projects.  The output is apk file for Android and Xcode project file for iOS.

You can publish your project by using either interactive mode or parameters which are below.

You can find a sample project workspace at [https://github.com/SmartfaceIO/smfc-empty-workspace](https://github.com/SmartfaceIO/smfc-empty-workspace)

Easiest way to start using the CLI tool is via the interactive mode:

    smfc -i

More details about the interactive mode are explained below.



You can get the help screen by executing the below command:

    smfc -h

You will see the following screen:

      Smartface Command-Line Interface, version 5.2.13  
      
        
      Usage: smfc [options]
        
      Smartface Command-Line Interface
        
      Options:
      
         -h, --help                         General Help
         -v, --version                      Print smfc's version.
         -i, --interactive                  Smartface Command-Line Interface in interactive mode
         --help=<options or tasks>          General help
         --task=<task>                      Task to execute
         --projectRoot=<root path>          Target project's root folder
         --path=<plugin project path>       Target plugin project's root folder
         --licenseFile=<license file path>  Your Smartface license file path
         --java=<java exec path>            Java 1.7 path
         --androidPlayer=<player arm apk>   Smartface Android Player zip
         --iosPlayer=<ios player>           Smartface iOS Player zip
         --profile=<profiles>               Android options for architecture and package profiles
         --maxJavaMemory=<memory size>      Maximum amount of memory to be consumed by Java
         --Xmx=<memory size>                Maximum amount of memory to be consumed by Java
         --logLevel=<level>                 Log Level
         --logFile=<file path>              Log to a specific file.
         --logStdOut=<status>               Log to console.
         --channels=<channels>              Channels that will be publishing. 
         --playerPath=<player path>         It denotes the path of the android plugin apk or iOS player file.
         
         

You can get detailed information about a CLI parameter by running **`smfc --help=<PARAMETER>`**.

On the other hand, you can run this command **`smfc --help=<TASK>`** to check what parameters are used in which the task.

For example, you can run

    smfc --help=task

And you will see the following screen:

    Smartface Command-Line Interface, version 5.2.13

    
    Option: --task
    
      Task to execute
    
    Example: 
    
      --task=publish:iOS,Android
    
    Description: 
    
      Task to execute


Another example, you can run

    smfc --help=publish
    
And you will see the following screen:

      Smartface Command-Line Interface, version 5.2.13  
        
      
      Task: publish
      
        Publish for iOS, Android
      
      Required: 
            
        task                 Task to execute
          
      Optional: 
          
        licenseFile          Your Smartface license file path
        java                 Java 1.7 path
        iosPlayer            Smartface iOS Player zip
        androidPlayer        Smartface Android Player zip
        maxJavaMemory        Maximum amount of memory to be consumed by Java
        logLevel             Log Level
        logFile              Log to a specific file.
        logStdOut            Log to console.
        projectRoot          Target project's root folder
        channels             Channels that will be publishing. 
            
      Example: 
      
        smfc --task=publish:android,ios 
      
      Advanced Example: 
      
    smfc --task=publish:android,ios --projectRoot=./workspace --channels test,production 
      
      Description: 
      
        You can publish for iOS, Android. If you want most details, you can contact us.


More detailed information is provided in the below sections on how to use the CLI parameters.

-------------
# First Time User

If you have not used the tool before, here is the most basic workflow that you can try.

Here are the steps to follow:

* Open your terminal.
* Run `smfc -i`.
* Choose `Sample Projects` and then choose `Blank Workspace` to download.
* Choose `Exit`.

-------------
# Interactive Mode

When you type `smfc -i` or `smfc --interactive` from your terminal, the interface below will appear:

      Smartface Command-Line Interface, version 5.2.13  



      »  task
    ? Which task that you want to be run (Use arrow keys)
    ❯ Check Environment & Dependencies 
      Sample Projects 
      create_iOSPlugin 
      generate_iOSPluginZip 
      generate_AndroidPluginZip 
      Exit 
      
If you want to use this interface for a specific project, first `cd $your_project` and then call `smfc -i`.

Once you do this, the CLI tool will provide sane defaults for your project, and in most cases there will be no need for you to change the defaults.

## Check Environment & Dependencies

You can check if you are missing any dependencies by choosing this selection. 

Something similar to the following will appear, depending on your platform and setup:

      Smartface Command-Line Interface, version 5.2.13  
      ( You can enter 'escape' at any time to back. )


      ┌───────────────────────────────────┐
      ├───┐                               │ 
      │ √ ├──  Environments  ─────────────┤ 
      ├───┘                               │ 
      ├────  √  Node.js      v4.4.5       │ 
      ├────  √  Java 1.7     1.7.0_101    │ 
      ├────  √  Git          2.8.4        │ 
      ├───┐                               │ 
      │ √ ├──  ia32-libs Dependencies  ───┤ 
      ├───┘                               │ 
      ├────  √  lib32z1                   │ 
      ├────  √  lib32ncurses5             │ 
      ├────  √  lib32bz2-1.0              │ 
      ├────  √  lib32stdc++6              │ 
      └───────────────────────────────────┘
      

-------------
## Samples

At the moment only a blank workspace sample is included.

But more will be included soon.

They will be downloaded to your `$HOME/Smartface/Samples/` folder.

      »  sample projects
    ? Select one of available projects for installing (Use arrow keys)
    ❯ Blank Workspace 

If you already downloaded the project, you will get the `This sample directory already exists.` error.

You can move or delete the project and try again.

## Advanced Usage

The CLI tool can be called with numerous parameters to control its input.

### Required Parameters
If you want to publish your project, you must use these arguments
- **task**
  Task that will be run. Supported tasks are listed below.
  - **publish**
  - **create_iOSPlugin**
  - **generate_iOSPluginZip**
  - **generate_AndroidPluginZip**

######  Example task
    --task=$(TASK) , --task=publish:Android,iOS
    
### Optional parameters
You can use optional parameters.

- **projectRoot**, **path**
  Your project root folder. You can also use relative paths.

###### Example projectRoot
    --projectRoot=$(PROJECT_ROOT) , --projectRoot=../smfc-sample
    
- **licenseFile**
   Your license file path

###### Example licenseFile
    --licenseFile=$(LICENSE) , --licenseFile=/home/Smartface/license.xml
  
- **java**
   Java 1.7 will be needed for the apk file operations. If you do not set this parameter, the tool will try to find Java 1.7, and use that version if it can find one.

###### Example java
    --java=$(JAVA) , --java=/usr/bin/java
  
- **androidPlayer**
   Smartface Player zip. You can set one of the players of Smartface.

###### Example androidPlayer  
    --androidPlayer=$(ANDROID_PLAYER) , --androidPlayer=/home/Smartface/SmartfacePlayer.zip

 - **iosPlayer**
   Smartface Player zip file for iOS. You can set one of the iOS-players of Smartface.

###### Example inputZip 
    --iosPlayer=$(IOS_PLAYER) , --iosPlayer=/home/Smartface/SmartfacePlayer.zip

- **maxJavaMemory**, **Xmx**
  Java to be used max memory while running.

###### Example maxJavaMemory
    --maxJavaMemory=$(MAX_JAVA_MEM) , --maxJavaMemory=512m
       
- **logLevel**
  Verbosity level of logging

  Available options are `ALL, TRACE, DEBUG, INFO, WARN, ERROR, FATAL, OFF`

###### Example logLevel 
    --logLevel=$(LOG_LEVEL) , --logLevel=debug
         
- **logFile**
  You can log to a specific file. Relative paths can be used.

###### Example logFile
    --logFile=$(LOG_FILE) , --logFile=../smfc-sample/log/some.log
  
- **logStdOut**
  You can display logs on the console.

  If `logLevel` is set to `OFF`, there will be no output on the console.

###### Example logStdOut
    --logStdOut=$(LOG_STDOUT) , --logStdOut=true
    
- **playerPath**
  It denotes the path of the android plugin apk or iOS player file.

###### Example playerPath
    --playerPath=$(PLAYER_PATH) , --playerPath=../smfc-sample/plugin.apk

- **channels**
  Channels that will be publishing.

###### Example channels
    --channels=$(CHANNEL1,CHANNEL2,...) , --channels=test,uat,production
    
-------------    
## Example Usages

#### publish

    smfc --task=publish:Android,iOS


    smfc --task=publish:Android,iOS --projectRoot=../smfc-sample  --logLevel=debug --logFile=../smfc-sample/log/ios.log --androidPlayer=./some/path/SmartfacePlayer.zip

#### create_iOSPlugin

    smfc --task=create_iOSPlugin --path=../sample-plugin


    smfc --task=create_iOSPlugin --path=../sample-plugin --playerPath=../../files/iOS_Player.zip

#### generate_iOSPluginZip

    smfc --task=generate_iOSPluginZip


    smfc --task=generate_iOSPluginZip --path=../sample-plugin
    
#### generate_AndroidPluginZip

    smfc --task=generate_AndroidPluginZip --playerPath=../plugin.apk


    smfc --task=generate_AndroidPluginZip --playerPath=../plugin.apk --path=../plugin --Xmx=200m
    
#### check_iOSConflict 
*only darwin platform*

    smfc --task=publish:check_iOSConflict

#### checkProject

    smfc --task=checkProject --projectRoot=/home/ubuntu/workspace/workspace
    

## Autocomplete
-------------
You can also use autocomplete on Linux or Mac OS X

- Examples

```
    smartface@smartface:~$ smfc -<TAB><TAB>
    --help         -i             --interactive  --task         -v             --versions
    smartface@smartface:~$ smfc -


```
```
    smartface@smartface:~$ smfc --task <TAB><TAB>
    create_iOSPlugin           generate_AndroidPluginZip  generate_iOSPluginZip  publish:
    smartface@smartface:~$ smfc --task ge<TAB><TAB>
    generate_AndroidPluginZip  generate_iOSPluginZip      
    smartface@smartface:~$ smfc --task generate_


```
```
    smartface@smartface:~$ smfc --task publish:Android --<TAB><TAB> 
    --aliasName              --inputApkPackageSuffix  --logLevel               --profile
    --androidPlayer          --java                   --logStdOut              --projectRoot
    --apkTool                --keyPass                --maxJavaMemory          --signer
    --autoPlay               --keystoreFile           --no-color               --tempFolder
    --channels               --keystorePass           --outputApk              
    --config_file            --licenseFile            --platform               
    --config_file_full_path  --logFile                --plugin                 
    smartface@smartface:~$ smfc --task publish:Android -- 
```


## Test
-------------

You can run `npm test` command for unit testing.

## Upgrade Notes
-------------

- For Android
    - generate Single APK for Multi-CPU Types (ARM - x86)
    - output apk name does not include CPU Type name. ( Smartface Demo.apk )
    - removed parameters `--inputApk`, `--inputApkx86` 
    - added paramater `--androidPlayer`
    - added parameter `--tdpid` for testing distribution

- For iOS
    - removed parameter `--inputZip`
    - added paramater `--iosPlayer`
    
- General
    - players and binaries are always downloaded during installation.
    - added meaningful error messages.
    - added downloading information during the installation.
    - changed xml-parser module to xmldom.
    - removed `Android-publish` `iOS-publish` from interactive mode.